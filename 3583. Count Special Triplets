class Solution {
public:
    int specialTriplets(vector<int>& nums) {

        int n = nums.size();
        // map<long, vector<long>> mp;
        long long ans = 0;
        int md = 1e9 + 7;

        unordered_map<int, vector<int>> mp;
        mp.reserve(n * 2);

        // store positions
        for (int i = 0; i < n; i++) {
            mp[nums[i]].push_back(i);
        }

        for (int i = 0; i < n; i++) {
            int key = nums[i] * 2;
            auto it = mp.find(key);
            if (it == mp.end()) continue;

            const vector<int>& v = it->second;
            if (v.size() <= 1) continue;

            // binary search on v (already sorted)
            int leftCount  = lower_bound(v.begin(), v.end(), i) - v.begin();
            int rightCount = v.end() - upper_bound(v.begin(), v.end(), i);

            ans = (ans + (long long)leftCount * rightCount) % md;
        }

        return ans;
    }
};
